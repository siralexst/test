<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <meta name="theme-color" content="#0f172a"/>
  <link rel="manifest" href="./manifest.json"/>
  <link rel="apple-touch-icon" href="icons/icon-192.png"/>
  <title>PWA Agenti – Futurist</title>
  <link rel="stylesheet" href="./style.css"/>

  <!-- Tailwind (CDN) pentru styling rapid) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- LocalForage: coadă offline pentru claim-uri când nu ai net -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-slate-900 text-slate-50">
  <header class="p-4 sticky top-0 z-40 backdrop-blur bg-slate-900/80 border-b border-white/10">
    <h1 class="text-xl font-semibold tracking-tight">PWA Agenti</h1>
    <p class="text-xs opacity-70">Colectare prețuri • Comparativ • Simulator comandă</p>
  </header>

  <!-- Nav tabs -->
  <nav class="grid grid-cols-3 text-center text-sm">
    <button class="tab-btn py-3 border-b-2 border-cyan-400" data-tab="tab1">Colectare</button>
    <button class="tab-btn py-3 border-b-2 border-transparent" data-tab="tab2">Comparativ</button>
    <button class="tab-btn py-3 border-b-2 border-transparent" data-tab="tab3">Simulator</button>
  </nav>

  <main class="p-4 space-y-8">
    <!-- TAB 1: Colectare preturi + Progress per competitor -->
    <section id="tab1" class="tab active space-y-6">
      <div>
        <h2 class="text-lg font-semibold">Progres competitori</h2>
        <div id="competitor-cards" class="mt-3 grid grid-cols-2 gap-3"></div>
      </div>

      <div class="rounded-2xl p-4 bg-gradient-to-br from-slate-800 to-slate-700 shadow-lg">
        <h3 class="font-semibold mb-3">Adaugă preț (claim)</h3>
        <div class="grid grid-cols-1 gap-3">
          <select id="produs-select" class="input"></select>
          <select id="competitor-select" class="input"></select>
          <input id="price-input" type="number" min="0" step="0.01" placeholder="Preț" class="input"/>
          <input id="agent-input" type="text" placeholder="Nume agent (opțional)" class="input"/>
          <button id="add-price-btn" class="btn-primary">Adaugă</button>
          <p id="collect-msg" class="text-xs opacity-70"></p>
        </div>
      </div>
    </section>

    <!-- TAB 2: Tabel comparativ -->
    <section id="tab2" class="tab hidden space-y-4">
      <div class="flex gap-2">
        <input id="search-input" class="input flex-1" placeholder="Caută produs… ex: Ariel"/>
        <button id="reload-compare" class="btn ghost">Reîncarcă</button>
      </div>
      <div id="compare-container" class="rounded-2xl overflow-hidden border border-white/10">
        <table class="w-full text-sm">
          <thead class="bg-slate-800/70">
          <tr>
            <th class="th">Produs</th>
            <th class="th">Preț nostru</th>
            <th class="th">Competitor</th>
            <th class="th">Preț</th>
            <th class="th">Dif (lei)</th>
            <th class="th">Dif (%)</th>
          </tr>
          </thead>
          <tbody id="compare-tbody" class="bg-slate-800/40"></tbody>
        </table>
      </div>
    </section>

    <!-- TAB 3: Simulator comenzi -->
    <section id="tab3" class="tab hidden space-y-4">
      <div class="grid grid-cols-1 gap-3">
        <select id="sim-product" class="input"></select>
        <input id="sim-qty" type="number" min="1" value="1" class="input" placeholder="Cantitate"/>
        <button id="sim-add" class="btn-primary">Adaugă în coș</button>
      </div>
      <div class="rounded-2xl overflow-hidden border border-white/10">
        <table class="w-full text-sm">
          <thead class="bg-slate-800/70">
          <tr>
            <th class="th">Produs</th>
            <th class="th">Preț nostru</th>
            <th class="th">Cel mai bun competitor</th>
            <th class="th">Preț comp.</th>
            <th class="th">Dif (lei)</th>
            <th class="th">Dif (%)</th>
            <th class="th">Cant.</th>
            <th class="th"></th>
          </tr>
          </thead>
          <tbody id="sim-tbody" class="bg-slate-800/40"></tbody>
        </table>
      </div>
      <div class="rounded-2xl p-4 bg-slate-800/60 flex items-center justify-between">
        <div>
          <div class="text-xs opacity-70">Total coș (noi)</div>
          <div id="sim-total" class="text-lg font-semibold">0.00 lei</div>
        </div>
        <div class="text-right">
          <div class="text-xs opacity-70">Discount necesar pt. competitivitate</div>
          <div id="sim-discount" class="text-lg font-semibold">0%</div>
        </div>
      </div>
    </section>
  </main>

  <script type="module" src="./app.js"></script>
  <script>
    // Register SW (PWA)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js');
      });
    }
  </script>
</body>
</html>
